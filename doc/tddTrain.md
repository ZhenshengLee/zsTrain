# 公司TDD代码大全教练

20180331，主讲人：马西照，李道春

## 随堂练习题目

要求编写一个简单的计算器，该计算器只需要支持**1位正整数**的加减乘除运算，并支持小括号的使用。

* 加法和减法的优先级相同
* 乘法和除法的优先级相同
* 括号的优先级最高
* 乘除法的优先级高于加减法
* 同一优先级的运算顺序为自左向右

## 推荐书籍

* 代码大全
* 测试驱动开发
* 敏捷软件开发：原则，模式与实践
* 代码整洁之道

## 上午培训

### TDD的概念

* 测试驱动开发，不是一种测试技术，而是一种开发技术-Kent Beck-1999
* 很短的开发周期
* 需求转换成用例，简单实现让用例通过（仅仅让用例通过），
* 用这种开发方法，在心理学上给程序员以自信心

#### 三步军规

* 用例：编译通过，运行不通过
* 实现：快速实现，运行通过
* 重构：准备下个流程

#### 重构要点

1. 消除重复
2. 提高表达力
3. 领域规则

### 开始做题

#### '0' 和 "0"的区别

内存中，一个是0x30
一个是0x30 0x00

#### 引用和非引用的区别

## 下午课程

### 为什么要编写用例

* 用例可以无形中获取到开发可能遇到的问题和软件可能的流程
* 对整个过程有个清晰的了解

### 为什么需要快速通过

* 敏捷的要求
* 快速才会

### 下午主讲重构

重构，不改变职责的基础上修改代码

* DRY(Do not Repeat Yourself)
* 单一职责，一个函数实现一个功能
* 函数名和变量名要符合规范

* 有的时候快速实现太麻烦，那么就略过，直接重构
* 技巧：先写一个函数，调试通过，然后替代他的函数
* 举例：实现简单乘法，先做一个expr_mux(),然后在考虑重构合并到主函数中。

* 返回值有的时候只需要一个很短的类型，但是还是建议选择DWORD，最长的，为什么？
* 避免可能产生的越界问题，尤其是局部变量的时候。

### 领域规则

领域规则就是具体问题具体分析。

* 乘法能够代替num
* 一个数可以看做1乘以这个数字
* 领域驱动设计，专注客户的业务需求
* 专注领域，代码写的再好，有什么用？

#### 领域方法

* 对比两个函数，运用领域方法，把业务上共同的东西抽取出来。
* 上层封装一个函数operation
* 把加变成乘加

### 领域统一

你如果用状态机来设计一个策略，判断符号，判断优先级，那么代码就会非常负责，我们要把复杂性简化到这个程度。

* 函数排序有优先级
* 函数指针用宏定义

乘可以替代Num,加可以替代EveryThing

1+2*3
1*1+2*3

(1)*(1)+(2)*(3)

## 其他

* 入口函数是用户接口
* 公共操作符

* 需求变化太快，有些OO思想已经跟不上。
* 为什么要首先不通过，不通过，说明你的代码可能没跑到
* 重构很重要，你首先不可能写得很好，都是从简单开始的，然后根据需求做一些适应性的变化。
* 电信网络设备？没人敢大改代码，到设备上试一次？不可能，所以用例给我们提交代码的信心。
* 领域知识，非常重要，业务太复杂了。不了解领域知识

### TDD两个好处

* 给我们信心，保证代码质量
* 重构过程中，深入理解领域知识，为我们挖掘需求
